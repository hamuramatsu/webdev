<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Macro #3</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            body {
                margin: 2em;
            }
            #container {
                display: flex; 
                align-items: flex-start;
                flex-flow: row wrap;
                /* justify-content: space-between; */
                font-family: Helvetica, Arial;
                gap: 1em;
            }

            #scene {
                width: 50%;
                /* margin-right: 1em; */
                margin-bottom: 1em;
                position: relative;
            }
            
            #background {
                display: block;
                width: 100%;
                border-radius: 1em;
            }

            #grasses {
                position: absolute;
                width: 100%;
                display: flex;
                bottom: 0px;
            }

            #grass1:hover {
                background-color: rgba(255, 181, 33, 0.5);
            }

            #grass2:hover {
                background-color: rgba(255, 181, 33, 0.5);
            }

            #grass3:hover {
                background-color: rgba(255, 181, 33, 0.5);
            }

            .grass {
                width: calc(100%/3);
            }

            #info {
                width: 30%;
                /* border: 1px solid black; */
                padding: 2em;
                /* margin-right: 1em; */
                margin-bottom: 1em;
                background-color: rgb(62, 91, 18);
                color: white;
                border-radius: 1em;
            }
            #info h1{
                margin: 0em;
                padding: 0.5rem 1rem;
                border-radius: 0.4em;
                background-color: white;
                color: rgb(62, 91, 18);
                text-align: center;
            }
            #info h2{
                margin: 0em;
                padding: 0.5rem;
                padding-left: 1rem;
                padding-right: 1rem;
                border-radius: 0.4em;
                border: 1px solid white;
                /* text-align: center; */
                /* width: fit-content; */
            }
            #info button {
                border: 1px solid white;
            }

            #playAgain {
                visibility: hidden;
            }

            #results h3 {
                margin-top: 0em;
                font-size: 1.5em;
                background-color:rgb(43, 98, 117);
                border-radius: 0.5em;
                padding: 0.5rem 1rem;
                color: white;
                text-align: center;
            }

            #pokedex {
                text-align: left;
            }
            #pokedex h4 {
                margin-top: 0em;
                font-size: 1.5em;
                margin-bottom: 0.5em;
                background-color:rgb(43, 98, 117);
                border-radius: 0.5em;
                padding: 0.5rem 1rem;
                color: white;
                text-align: center;
            }
            #name {
                width: 110px;
            }
            #count {
                width: 70px;
            }
            #histogram {
                width: 110px;
            }
            #pikachuHistogram {
                background-color: rgb(243, 218, 31);
                width: 0;
            }
            #bulbasaurHistogram {
                background-color: green;
                width: 0;
            }
            #charmanderHistogram {
                background-color: orange;
                width: 0;
            }
            #eeveeHistogram {
                background-color: rgb(122, 76, 36);
                width: 0;
            }
            #squirtleHistogram {
                background-color: lightblue;
                width: 0;
            }
            #rarepokemonHistogram {
                background-color: rgb(231, 161, 179);
                width: 0;
            }

            button {
                background-color: #ab563c;
                border: none;
                color: white;
                padding: 0.5rem 1rem;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                border-radius: 0.6em;
            }

        </style>
    </head>
    <body>
        <div id="container">
            <div id="scene">
                <img id="background" src="images/environment_forestbackground.png">
                <div id="grasses">
                    <img class="grass" id="grass1" src="images/grass.png" alt="grass1">
                    <img class="grass" id="grass2" src="images/grass.png" alt="grass2">
                    <img class="grass" id="grass3" src="images/grass.png" alt="grass3">

                    <!-- <div class="grass-container">
                        <img class="grass" id="grass1" src="images/grass.png" alt="grass1">
                        <img class="overlay" src="" style="display: none;">
                    </div>
                    <div class="grass-container">
                        <img class="grass" id="grass2" src="images/grass.png" alt="grass2">
                        <img class="overlay" src="" style="display: none;">
                    </div>
                    <div class="grass-container">
                        <img class="grass" id="grass3" src="images/grass.png" alt="grass3">
                        <img class="overlay" src="" style="display: none;">
                    </div> -->
                </div>

            </div>
            
            <div id="info">
                <h1>Gotta Catch 'Em All!</h1>
                <p>Your goal in this game is to earn as many Pokeballs as possible while catching a variety of Pokemon along the way.</p>
                <br>
                <h2 id="progress">Your progress so far...</h2>
                <p>Pokeballs left: <span id="pokeballsLeft">5</span></p>
                <p>Pokemon caught: <span id="pokemonCaught">0</span></p>
                <button id="playAgain">Play again</button>
                <p id="gameOver"></p>
            </div>

            <div id="results">
                <h3>Game History</h3>
                <ul id="resultHistory"></ul>
                <button id="clearHistory">Clear History</button>
                <button id="startOver">Start Over</button>
            </div>

            <div id="pokedex">
                <h4>Pokedex</h4>
                <table>
                    <tr>
                        <th id="name">Pokemon</th>
                        <th id="count">Count</th>
                        <th id="histogram">Histogram</th>
                    </tr>
                    <tr id="pikachuRow">
                        <td>Pikachu</td>
                        <td id="pikachuCount">0</td>
                        <td><div id="pikachuHistogram">&nbsp;</div></td>
                    </tr>
                    <tr>
                        <td>Bulbasaur</td>
                        <td id="bulbasaurCount">0</td>
                        <td><div id="bulbasaurHistogram">&nbsp;</div></td>
                    </tr>
                    <tr>
                        <td>Charmander</td>
                        <td id="charmanderCount">0</td>
                        <td><div id="charmanderHistogram">&nbsp;</div></td>
                    </tr>
                    <tr>
                        <td>Eevee</td>
                        <td id="eeveeCount">0</td>
                        <td><div id="eeveeHistogram">&nbsp;</div></td>
                    </tr>
                    <tr>
                        <td>Squirtle</td>
                        <td id="squirtleCount">0</td>
                        <td><div id="squirtleHistogram">&nbsp;</div></td>
                    </tr>
                    <tr>
                        <td>Rare Pokemon</td>
                        <td id="rarepokemonCount">0</td>
                        <td><div id="rarepokemonHistogram">&nbsp;</div></td>
                    </tr>
                </table>
                <p id="specialMessage"></p>
            </div>
        </div>

        
        <script>
            // DOM queries
            const grass1 = document.getElementById('grass1');            
            const grass2 = document.getElementById('grass2');            
            const grass3 = document.getElementById('grass3');
            const progress = document.getElementById('progress');
            const pokeballsLeft = document.getElementById('pokeballsLeft');
            const pokemonCaught = document.getElementById('pokemonCaught');
            const playAgain = document.getElementById('playAgain');
            const gameOver = document.getElementById("gameOver");
            const resultHistoryList = document.getElementById("resultHistory");
            const clearHistoryBtn = document.getElementById("clearHistory");
            const startOverBtn = document.getElementById("startOver");

            // possible pokemon
            const pokemon = [
                {name:'Pikachu', image:'images/pikachu.png'}, 
                {name:'Bulbasaur', image:'images/bulbasaur.png'},
                {name:'Charmander', image:'images/charmander.png'},
                {name:'Eevee', image:'images/eevee.png'},
                {name:'Squirtle', image:'images/squirtle.png'}
            ];

            // FEATURE #3: super item types
            const superItems = [
                { name: "Pokeball Bonus", effect: "pokeballBonus", image: "images/pokeballx4.png" },
                { name: "Rare Pokemon1", effect: "rarePokemon1", image: "images/jirachi.png" },
                { name: "Rare Pokemon2", effect: "rarePokemon2", image: "images/manaphy.png" }
            ];

            // variable to store active super item
            let activeSuperItem = null;
            // track if super item mode is active
            let isSuperItemMode = false; 

            //create some global variables
            let pokeballsLeftCounter = 5;
            let pokemonCaughtCounter = 0; //do math w int. then change to string
            let gameStateOn = true;
            let resultHistory = [];
            
            // FEATURE #3: function to decide if super item mode is active BEFORE user clicks
            function activateSuperItemMode() {
                if (Math.random() < 0.1) {  // 10% chance to activate
                    isSuperItemMode = true;
                    activeSuperItem = superItems[Math.floor(Math.random() * superItems.length)];
                    document.getElementById("progress").innerText = "You're in 'Super Item' mode!";
                } else {
                    isSuperItemMode = false;
                    activeSuperItem = null;
                }
            }

            // call function function when clicking play again
            function startNewRound() {
                // decide if super item mode is active
                activateSuperItemMode();
                gameStateOn = true;
            }

            function oneRound(grassNum) {
                // don't run the function if game state is paused
                if (!gameStateOn) return;

                let chance;

                if (isSuperItemMode) {
                    // super Item logic
                    grassNum.src = `${activeSuperItem.image}`;
                    handleSuperItem(activeSuperItem.effect);
                    isSuperItemMode = false; // Reset mode after use
                    activeSuperItem = null;
                } else {
                    // continue with normal game logic
                    // generate random  new source
                    chance = parseInt(Math.random() * 3);
                    // console.log(chance);
                    // 1. more pokeballs
                    if (chance == 0 ) {
                        grassNum.src = "images/pokeballs.png";
                        progress.innerText = "You found 2 pokeballs";
                        pokeballsLeftCounter += 2;
                        //update pokeball count
                        pokeballsLeft.innerText = `${pokeballsLeftCounter}`;
                        // add to history
                        updateHistory("Pokeballs found (+2)");
                    }
                    // 2. pokemon
                    if (chance == 1) {
                        let foundPokemon = pokemon[parseInt(Math.random() * pokemon.length)];
                        grassNum.src = foundPokemon.image;
                        progress.innerText = `You found a ${foundPokemon.name}`;
                        pokemonCaughtCounter += 1;
                        // update pokemon caught
                        pokemonCaught.innerText = `${pokemonCaughtCounter}`;
                        // add to history
                        updateHistory(`${foundPokemon.name} found`);
                        // update pokedex
                        updatePokedex(foundPokemon.name);
                    }
                    // 3. nothing
                    if (chance == 2) {
                        grassNum.style.visibility = "hidden";
                        progress.innerText = `Nothing here!`;
                        // add to history
                        updateHistory("Nothing found");
                    }
                }

                // decrease the pokeballs left
                pokeballsLeftCounter -= 1;
                pokeballsLeft.innerText = `${pokeballsLeftCounter}`;
                
                // pause game state
                gameStateOn = false;

                // FEATURE #4: reveal the missed grassy areas (only for normal rounds, not superItemMode)
                if (!isSuperItemMode && chance !== undefined) {
                    revealMissedAreas(grassNum, chance, false);
                }
                
                // check if use is out of pokeballs
                if (pokeballsLeftCounter <= 0) {
                    gameOver.innerText = "Game over -- you ran out of pokeballs";
                } else {
                    // show playAgain button
                    playAgain.style.visibility = "visible";
                }
            }

            // call function on grass click
            grass1.onclick = () => oneRound(grass1);
            grass2.onclick = () =>  oneRound(grass2);
            grass3.onclick = () =>  oneRound(grass3);
            
            // function to reset grass, etc.
            function playAgainFunc(){
                playAgain.style.visibility = "hidden";
                // return all grass to normal
                const allGrass = document.querySelectorAll(".grass");
                for (let i=0; i<allGrass.length; i++) {
                    allGrass[i].style.visibility = "visible";
                    allGrass[i].src = "images/grass.png";
                    allGrass[i].style.opacity = "1";
                }
                // turn game state on again
                gameStateOn = true;

                startNewRound(); // Restart game logic
            }

            // play again button
            playAgain.onclick = playAgainFunc;

            
            // FEATURE #1: function to update result history
            function updateHistory(result) {
                // add result to start of array - reverse order
                resultHistory.unshift(result);
                renderHistory();
            }
            // FEATURE #1: function to add to game history
            function renderHistory() {
                 // clear list
                resultHistoryList.innerHTML = "";
                // append result
                resultHistory.forEach((result) => {
                    let li = document.createElement("li");
                    li.innerText = result;
                    resultHistoryList.appendChild(li);
                });
            }
            // FEATURE #1: function to clear game history
            clearHistoryBtn.onclick = function () {
                // reset history array
                resultHistory = [];
                renderHistory();
            };
            // FEATURE #1: start over button click - restart the game
            startOverBtn.onclick = function () {
                // reset game state
                pokeballsLeftCounter = 5;
                pokemonCaughtCounter = 0;
                resultHistory = [];
                // update UI
                pokeballsLeft.innerText = `${pokeballsLeftCounter}`;
                pokemonCaught.innerText = `${pokemonCaughtCounter}`;
                progress.innerText = "Game restarted! Click the grass!";
                // clear history
                renderHistory();
                // clear game over text
                gameOver.innerText = "";
                // play again
                playAgainFunc();
            };


            // FEATURE #2: track pokemon caught
            let pokedex = {
                Pikachu: 0,
                Bulbasaur: 0,
                Charmander: 0,
                Eevee: 0,
                Squirtle: 0,
                RarePokemon: 0
            };
            // FEATURE #2: add to pokedex
            function updatePokedex(pokemonName) {
                // update count
                pokedex[pokemonName]++;
                // update count in table
                document.getElementById(`${pokemonName.toLowerCase()}Count`).innerText = pokedex[pokemonName];
                // update histogram
                document.getElementById(`${pokemonName.toLowerCase()}Histogram`).style.width = `${pokedex[pokemonName] * 20}px`;
                // display message if caught at least one of each pokemon
                if (Object.values(pokedex).every(count => count > 0)) {
                    document.getElementById("specialMessage").innerText = "Congratulations! You've caught at least one of each Pokémon!";
                }
            }
            

            // FEATURE #3: function to apply effect of a super item
            function handleSuperItem(effect) {
                switch (effect) {
                    case "pokeballBonus":
                        pokeballsLeftCounter += 4;
                        document.getElementById("progress").innerText = "You found a bonus 4 Pokeballs!";
                        document.getElementById("pokeballsLeft").innerText = pokeballsLeftCounter;
                        updateHistory("Pokeballs found (+4)");
                        break;
                    case "rarePokemon1":
                        document.getElementById("progress").innerText = "You caught a Rare Pokemon: Jirachi!";
                        // update pokemon caught
                        pokemonCaughtCounter += 1;
                        pokemonCaught.innerText = `${pokemonCaughtCounter}`;
                        // add to history
                        updateHistory("Jirachi found");
                        // update pokedex
                        updatePokedex("RarePokemon");
                        break;
                    case "rarePokemon2":
                        document.getElementById("progress").innerText = "You caught a Rare Pokemon: Manaphy!";
                        // update pokemon caught
                        pokemonCaughtCounter += 1;
                        pokemonCaught.innerText = `${pokemonCaughtCounter}`;
                        // add to history
                        updateHistory("Manaphy found");
                        // update pokedex
                        updatePokedex("RarePokemon");
                        break;
                }
            }


            // FEATURE #4: missed areas (not in superItemMode)
            function revealMissedAreas(clickedGrass, chance) {
                // console.log(chance)
                // determine what outcomes to assign to the two missed grasses
                let outcomes = [];
                if (chance === 0) { 
                    // user found pokeballs
                    // missed outcomes: one shows a pokemon, the other shows nothing
                    outcomes.push({ type: 'pokemon' });
                    outcomes.push({ type: 'nothing' });
                } else if (chance === 1) { 
                    // sser found a pokemon
                    // missed outcomes: one shows pokeballs, the other shows nothing
                    outcomes.push({ type: 'pokeballs' });
                    outcomes.push({ type: 'nothing' });
                } else if (chance === 2) { 
                    // user found nothing
                    // missed outcomes: one shows pokeballs, the other shows a pokemon
                    outcomes.push({ type: 'pokeballs' });
                    outcomes.push({ type: 'pokemon' });
                } else {
                    return;
                }
                // shuffle outcomes randomly
                outcomes.sort(() => Math.random() - 0.5);
                // get all grass elements
                const allGrass = document.querySelectorAll(".grass");
                let outcomeIndex = 0;
                // grass images
                allGrass.forEach(grass => {
                    if (grass !== clickedGrass) {
                        let outcome = outcomes[outcomeIndex];
                        if (outcome.type === 'pokeballs') {
                            grass.src = "images/pokeballs.png";
                            // make visible
                            grass.style.visibility = "visible";
                        } else if (outcome.type === 'pokemon') {
                            // choose a random pokemon image
                            let randPokemon = pokemon[Math.floor(Math.random() * pokemon.length)];
                            grass.src = randPokemon.image;
                            grass.style.visibility = "visible";
                        } else if (outcome.type === 'nothing') {
                            // hide grass
                            grass.style.visibility = "hidden";
                        }
                        // less opacity
                        grass.style.opacity = "0.5";
                        outcomeIndex++;
                    }
                });
            }
            

        </script>
        
    </body>
</html>